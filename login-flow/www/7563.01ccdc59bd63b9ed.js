"use strict";(self.webpackChunklogin_flow=self.webpackChunklogin_flow||[]).push([[7563],{7563:($,S,u)=>{u.r(S),u.d(S,{StripeWeb:()=>O});var o=u(5861),T=u(7423),s=u(2903),l=(()=>{return(e=l||(l={})).Loaded="paymentFlowLoaded",e.FailedToLoad="paymentFlowFailedToLoad",e.Opened="paymentFlowOpened",e.Created="paymentFlowCreated",e.Completed="paymentFlowCompleted",e.Canceled="paymentFlowCanceled",e.Failed="paymentFlowFailed",l;var e})(),p=(()=>{return(e=p||(p={})).Loaded="applePayLoaded",e.FailedToLoad="applePayFailedToLoad",e.Completed="applePayCompleted",e.Canceled="applePayCanceled",e.Failed="applePayFailed",e.DidSelectShippingContact="applePayDidSelectShippingContact",e.DidCreatePaymentMethod="applePayDidCreatePaymentMethod",p;var e})(),c=(()=>{return(e=c||(c={})).Loaded="googlePayLoaded",e.FailedToLoad="googlePayFailedToLoad",e.Completed="googlePayCompleted",e.Canceled="googlePayCanceled",e.Failed="googlePayFailed",c;var e})();const q=(e=window)=>{if(typeof e>"u")return[];e.Ionic=e.Ionic||{};let n=e.Ionic.platforms;return null==n&&(n=e.Ionic.platforms=R(e),n.forEach(t=>e.document.documentElement.classList.add(`plt-${t}`))),n},R=e=>Object.keys(F).filter(n=>F[n](e)),f=e=>!!(d(e,/iPad/i)||d(e,/Macintosh/i)&&h(e)),P=e=>d(e,/android|sink/i),h=e=>H(e,"(any-pointer:coarse)"),L=e=>g(e)||A(e),g=e=>!!(e.cordova||e.phonegap||e.PhoneGap),A=e=>!!e.Capacitor?.isNative,d=(e,n)=>n.test(e.navigator.userAgent),H=(e,n)=>e.matchMedia(n).matches,F={ipad:f,iphone:e=>d(e,/iPhone/i),ios:e=>d(e,/iPhone|iPod/i)||f(e),android:P,phablet:e=>{const n=e.innerWidth,t=e.innerHeight,i=Math.min(n,t),a=Math.max(n,t);return i>390&&i<520&&a>620&&a<800},tablet:e=>{const n=e.innerWidth,t=e.innerHeight,i=Math.min(n,t),a=Math.max(n,t);return f(e)||(e=>P(e)&&!d(e,/mobile/i))(e)||i>460&&i<820&&a>780&&a<1400},cordova:g,capacitor:A,electron:e=>d(e,/electron/i),pwa:e=>!(!e.matchMedia("(display-mode: standalone)").matches&&!e.navigator.standalone),mobile:h,mobileweb:e=>h(e)&&!L(e),desktop:e=>!h(e),hybrid:L};class O extends T.Uw{constructor(){super({name:"Stripe",platforms:["web"]})}initialize(n){var t=this;return(0,o.Z)(function*(){if("string"!=typeof n.publishableKey||0===n.publishableKey.trim().length)throw new Error("you must provide a valid key");t.publishableKey=n.publishableKey,n.stripeAccount&&(t.stripeAccount=n.stripeAccount)})()}createPaymentSheet(n){var t=this;return(0,o.Z)(function*(){var i;t.publishableKey?(t.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(t.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),t.paymentSheet.publishableKey=t.publishableKey,t.stripeAccount&&(t.paymentSheet.stripeAccount=t.stripeAccount),t.paymentSheet.applicationName="@capacitor-community/stripe",t.paymentSheet.intentClientSecret=n.paymentIntentClientSecret,t.paymentSheet.intentType="payment",void 0!==n.withZipCode&&(t.paymentSheet.zip=n.withZipCode),t.notifyListeners(s.Y.Loaded,null)):t.notifyListeners(s.Y.FailedToLoad,null)})()}presentPaymentSheet(){var n=this;return(0,o.Z)(function*(){if(!n.paymentSheet)throw new Error;const t=yield n.paymentSheet.present();if(void 0===t)return n.notifyListeners(s.Y.Canceled,null),{paymentResult:s.Y.Canceled};const{detail:{stripe:i,cardNumberElement:a}}=t,r=yield i.createPaymentMethod({type:"card",card:a});return n.paymentSheet.updateProgress("success"),n.paymentSheet.remove(),void 0!==r.error?(n.notifyListeners(s.Y.Failed,null),{paymentResult:s.Y.Failed}):(n.notifyListeners(s.Y.Completed,null),{paymentResult:s.Y.Completed})})()}createPaymentFlow(n){var t=this;return(0,o.Z)(function*(){var i;t.publishableKey?(t.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(t.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),t.paymentSheet.publishableKey=t.publishableKey,t.stripeAccount&&(t.paymentSheet.stripeAccount=t.stripeAccount),t.paymentSheet.applicationName="@capacitor-community/stripe",n.hasOwnProperty("paymentIntentClientSecret")?(t.paymentSheet.intentType="payment",t.paymentSheet.intentClientSecret=n.paymentIntentClientSecret):(t.paymentSheet.intentType="setup",t.paymentSheet.intentClientSecret=n.setupIntentClientSecret),void 0!==n.withZipCode&&(t.paymentSheet.zip=n.withZipCode),((e,n)=>("string"==typeof e&&(n=e,e=void 0),(e=>q(e))(e).includes(n)))(window,"ios")?(t.paymentSheet.buttonLabel="Add card",t.paymentSheet.sheetTitle="Add a card"):t.paymentSheet.buttonLabel="Add",t.notifyListeners(l.Loaded,null)):t.notifyListeners(l.FailedToLoad,null)})()}presentPaymentFlow(){var n=this;return(0,o.Z)(function*(){if(!n.paymentSheet)throw new Error;n.notifyListeners(l.Opened,null);const t=yield n.paymentSheet.present().catch(()=>{});if(void 0===t)throw n.notifyListeners(l.Canceled,null),new Error;const{detail:{stripe:i,cardNumberElement:a}}=t,{token:r}=yield i.createToken(a);if(void 0===r||void 0===r.card)throw new Error;return n.flowStripe=i,n.flowCardNumberElement=a,n.notifyListeners(l.Created,{cardNumber:r.card.last4}),{cardNumber:r.card.last4}})()}confirmPaymentFlow(){var n=this;return(0,o.Z)(function*(){if(!n.paymentSheet||!n.flowStripe||!n.flowCardNumberElement)throw new Error;return void 0!==(yield n.flowStripe.createPaymentMethod({type:"card",card:n.flowCardNumberElement})).error&&n.notifyListeners(l.Failed,null),n.paymentSheet.updateProgress("success"),n.paymentSheet.remove(),n.notifyListeners(l.Completed,null),{paymentResult:l.Completed}})()}isApplePayAvailable(){return this.isAvailable("applePay")}createApplePay(n){var t=this;return(0,o.Z)(function*(){t.publishableKey?(t.requestApplePay=yield t.createPaymentRequestButton(),t.requestApplePayOptions=n,t.notifyListeners(p.Loaded,null)):t.notifyListeners(p.FailedToLoad,null)})()}presentApplePay(){return this.presentPaymentRequestButton("applePay",this.requestApplePay,this.requestApplePayOptions,p)}isGooglePayAvailable(){return this.isAvailable("googlePay")}createGooglePay(n){var t=this;return(0,o.Z)(function*(){t.publishableKey?(t.requestGooglePay=yield t.createPaymentRequestButton(),t.requestGooglePayOptions=n,t.notifyListeners(c.Loaded,null)):t.notifyListeners(c.FailedToLoad,null)})()}presentGooglePay(){return this.presentPaymentRequestButton("googlePay",this.requestGooglePay,this.requestGooglePayOptions,c)}isAvailable(n){var t=this;return(0,o.Z)(function*(){var i;const a=document.createElement("stripe-payment-request-button");return a.id=`isAvailable-${n}`,null===(i=document.querySelector("body"))||void 0===i||i.appendChild(a),yield customElements.whenDefined("stripe-payment-request-button"),t.publishableKey&&(a.publishableKey=t.publishableKey),t.stripeAccount&&(a.stripeAccount=t.stripeAccount),a.applicationName="@capacitor-community/stripe",yield a.isAvailable(n).finally(()=>a.remove())})()}createPaymentRequestButton(){var n=this;return(0,o.Z)(function*(){var t;const i=document.createElement("stripe-payment-request-button");return null===(t=document.querySelector("body"))||void 0===t||t.appendChild(i),yield customElements.whenDefined("stripe-payment-request-button"),n.publishableKey&&(i.publishableKey=n.publishableKey),n.stripeAccount&&(i.stripeAccount=n.stripeAccount),i.applicationName="@capacitor-community/stripe",i})()}presentPaymentRequestButton(n,t,i,a){var r=this;return(0,o.Z)(function*(){return new Promise(function(){var z=(0,o.Z)(function*(y){if(void 0===t||void 0===i||void 0===r.publishableKey)return r.notifyListeners(a.Failed,null),y({paymentResult:a.Failed});yield t.setPaymentRequestOption({country:i.countryCode.toUpperCase(),currency:i.currency.toLowerCase(),total:i.paymentSummaryItems[i.paymentSummaryItems.length-1],disableWallets:"applePay"===n?["googlePay","browserCard"]:["applePay","browserCard"],requestPayerName:!0,requestPayerEmail:!0});const v=i.paymentIntentClientSecret;yield t.setPaymentMethodEventHandler(function(){var U=(0,o.Z)(function*(m,b){const{paymentIntent:C,error:w}=yield b.confirmCardPayment(v,{payment_method:m.paymentMethod.id},{handleActions:!1});if(w)return m.complete("fail"),r.notifyListeners(a.Failed,w),y({paymentResult:a.Failed});if("requires_action"===C?.status){const{error:K}=yield b.confirmCardPayment(v);if(K)return m.complete("fail"),r.notifyListeners(a.Failed,K),y({paymentResult:a.Failed})}return m.complete("success"),r.notifyListeners(a.Completed,null),y({paymentResult:a.Completed})});return function(m,b){return U.apply(this,arguments)}}()),yield t.initStripe(r.publishableKey,{stripeAccount:r.stripeAccount,showButton:!1})});return function(y){return z.apply(this,arguments)}}())})()}}}}]);